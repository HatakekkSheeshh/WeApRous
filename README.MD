# Assignment 1 - HTTP Server and Chat Application

**HCMC University of Technology**  
**Faculty of Computer Science & Engineering**  
**Course: Computer Networks (CO3094)**  
**Date: October 2025**

---

## ğŸ“‹ Má»¥c lá»¥c

1. [Tá»•ng quan](#tá»•ng-quan)
2. [Kiáº¿n trÃºc há»‡ thá»‘ng](#kiáº¿n-trÃºc-há»‡-thá»‘ng)
3. [CÃ i Ä‘áº·t](#cÃ i-Ä‘áº·t)
4. [HÆ°á»›ng dáº«n sá»­ dá»¥ng](#hÆ°á»›ng-dáº«n-sá»­-dá»¥ng)
5. [Demo Scenarios](#demo-scenarios)
6. [API Documentation](#api-documentation)
7. [Testing](#testing)
8. [Káº¿t quáº£ Ä‘áº¡t Ä‘Æ°á»£c](#káº¿t-quáº£-Ä‘áº¡t-Ä‘Æ°á»£c)

---

## ğŸ¯ Tá»•ng quan

Project nÃ y implement má»™t **HTTP server** káº¿t há»£p **hybrid chat application**, bao gá»“m:

### **Task 1: HTTP Server with Cookie Session (3 Ä‘iá»ƒm)**
- âœ… Cookie-based authentication
- âœ… Session management
- âœ… Access control cho protected resources

### **Task 2: Hybrid Chat Application (4 Ä‘iá»ƒm)**
- âœ… **Client-Server paradigm**: Tracker server quáº£n lÃ½ peers
- âœ… **Peer-to-Peer paradigm**: Direct messaging khÃ´ng qua server
- âœ… **Channel management**: Join channels, broadcast messages
- âœ… **Concurrency**: Thread-safe operations
- âœ… **Error handling**: Robust error recovery

---

## ğŸ—ï¸ Kiáº¿n trÃºc há»‡ thá»‘ng

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          HTTP Server Layer                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Proxy   â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Backend   â”‚           â”‚
â”‚  â”‚  :8080   â”‚        â”‚   :9000     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Chat Application Layer                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚   Chat Tracker Server :8001      â”‚           â”‚
â”‚  â”‚   - Peer registration            â”‚           â”‚
â”‚  â”‚   - Channel management           â”‚           â”‚
â”‚  â”‚   - Peer discovery               â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                 â”‚                                â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚        â”‚                 â”‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  Peer A   â”‚â—„â”€â”€â”€â–ºâ”‚  Peer B   â”‚               â”‚
â”‚  â”‚  :9101    â”‚  P2Pâ”‚  :9102    â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ CÃ i Ä‘áº·t

### **YÃªu cáº§u há»‡ thá»‘ng:**
- Python 2.7 hoáº·c Python 3.x
- macOS, Linux, hoáº·c Windows
- KhÃ´ng cáº§n cÃ i thÃªm thÆ° viá»‡n (chá»‰ dÃ¹ng standard library)

### **Cáº¥u trÃºc thÆ° má»¥c:**
```
CO3094-weaprous2/
â”œâ”€â”€ daemon/                    # Framework modules
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ backend.py            # Backend server
â”‚   â”œâ”€â”€ proxy.py              # Proxy server
â”‚   â”œâ”€â”€ request.py            # HTTP request handling
â”‚   â”œâ”€â”€ response.py           # HTTP response building
â”‚   â”œâ”€â”€ httpadapter.py        # HTTP adapter (Task 1 implementation)
â”‚   â”œâ”€â”€ weaprous.py           # WeApRous framework
â”‚   â””â”€â”€ dictionary.py         # Case-insensitive dict
â”œâ”€â”€ www/                      # Static HTML pages
â”‚   â”œâ”€â”€ index.html           # Protected page
â”‚   â”œâ”€â”€ login.html           # Login form
â”‚   â””â”€â”€ chat.html            # Chat UI (bonus)
â”œâ”€â”€ static/                   # Static assets
â”‚   â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ images/
â”‚   â””â”€â”€ js/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ proxy.conf           # Proxy configuration
â”œâ”€â”€ start_proxy.py           # Start proxy server
â”œâ”€â”€ start_backend.py         # Start backend server
â”œâ”€â”€ start_chatapp.py         # â­ Chat Tracker Server (Task 2)
â”œâ”€â”€ peer_client.py           # â­ P2P Peer Client (Task 2)
â”œâ”€â”€ test_chat.py             # â­ Automated tests
â””â”€â”€ README.md                # This file
```

---

## ğŸš€ HÆ°á»›ng dáº«n sá»­ dá»¥ng

### **1. Test Cookie Session (Task 1)**

#### **BÆ°á»›c 1: Start Backend Server**
```bash
cd /Users/vuhaituan/Downloads/CO3094-weaprous2
python start_backend.py --server-ip 0.0.0.0 --server-port 9000
```

#### **BÆ°á»›c 2: Start Proxy Server**
```bash
# Terminal má»›i
python start_proxy.py --server-ip 0.0.0.0 --server-port 8080
```

#### **BÆ°á»›c 3: Test vá»›i Browser**
1. Má»Ÿ browser (Incognito mode khuyáº¿n nghá»‹)
2. Truy cáº­p: `http://127.0.0.1:8080/`
   - âŒ Káº¿t quáº£: 401 Unauthorized (chÆ°a cÃ³ cookie)
3. Truy cáº­p: `http://127.0.0.1:8080/login.html`
   - âœ… Hiá»ƒn thá»‹ login form
4. Login vá»›i:
   - Username: `admin`
   - Password: `password`
   - âœ… Káº¿t quáº£: Set cookie vÃ  redirect Ä‘áº¿n index.html
5. Truy cáº­p láº¡i: `http://127.0.0.1:8080/`
   - âœ… Káº¿t quáº£: 200 OK (cÃ³ cookie há»£p lá»‡)

#### **BÆ°á»›c 4: Test vá»›i curl**
```bash
# Test 1: Truy cáº­p khÃ´ng cÃ³ cookie
curl -v http://127.0.0.1:8080/
# Expected: 401 Unauthorized

# Test 2: Login
curl -X POST http://127.0.0.1:8080/login \
  -d "username=admin&password=password" \
  -c cookies.txt -v
# Expected: 200 OK, Set-Cookie: auth=true

# Test 3: Truy cáº­p vá»›i cookie
curl -b cookies.txt http://127.0.0.1:8080/
# Expected: 200 OK, hiá»ƒn thá»‹ index.html
```

---

### **2. Test Chat Application (Task 2)**

#### **BÆ°á»›c 1: Start Chat Tracker Server**
```bash
python start_chatapp.py --server-ip 0.0.0.0 --server-port 8001
```

**Káº¿t quáº£:**
```
============================================================
Starting Chat Tracker Server
IP: 0.0.0.0
Port: 8001
============================================================
[Backend] Listening on port 8001
```

#### **BÆ°á»›c 2: Test APIs**
```bash
# Test Login
curl -X POST http://127.0.0.1:8001/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"password"}'
# Expected: {"status": "success", "token": "token_admin"}

# Test Register
curl -X POST http://127.0.0.1:8001/register \
  -H "Content-Type: application/json" \
  -d '{"username":"alice","password":"alice123"}'
# Expected: {"status": "success", "message": "User registered successfully"}

# Test Peer Registration
curl -X POST http://127.0.0.1:8001/submit-info \
  -H "Content-Type: application/json" \
  -d '{"username":"alice","ip":"127.0.0.1","port":9101,"channels":["general"]}'
# Expected: {"status": "success", "peer_id": 0, "total_peers": 1}

# Test Join Channel
curl -X POST http://127.0.0.1:8001/add-list \
  -H "Content-Type: application/json" \
  -d '{"username":"alice","channel":"tech-talk"}'
# Expected: {"status": "success", "channel": "tech-talk", "members": ["alice"]}

# Test Get Peer List
curl -X POST http://127.0.0.1:8001/get-list \
  -H "Content-Type: application/json" \
  -d '{}'
# Expected: {"status": "success", "peers": [...], "channels": {...}}

# Test Server Status
curl http://127.0.0.1:8001/status
# Expected: {"status": "online", "stats": {...}}
```

#### **BÆ°á»›c 3: Start Peer Clients**

**Terminal 1 - Alice:**
```bash
python peer_client.py --username alice --peer-port 9101 --tracker-ip 127.0.0.1 --tracker-port 8001
```

**Trong Alice terminal:**
```
> join general
[Peer] Joined channel: general

> join tech
[Peer] Joined channel: tech

> list
[Peer] Retrieved X peers from tracker
Active peers:
  - bob (127.0.0.1:9102)
```

**Terminal 2 - Bob:**
```bash
python peer_client.py --username bob --peer-port 9102 --tracker-ip 127.0.0.1 --tracker-port 8001
```

**Trong Bob terminal:**
```
> join general

> list
Active peers:
  - alice (127.0.0.1:9101)

> connect alice 127.0.0.1 9101
[Peer] Connecting to peer alice at 127.0.0.1:9101
[Peer] Connected to peer: alice

> send alice Hello Alice! This is Bob
[Peer] Sent message to alice: Hello Alice! This is Bob
```

**Quay láº¡i Alice terminal (tá»± Ä‘á»™ng hiá»ƒn thá»‹):**
```
[Peer] New P2P connection from ('127.0.0.1', xxxxx)
[Peer] Handshake from peer: bob
[Peer] Message from bob: Hello Alice! This is Bob
```

**Alice reply:**
```
> send bob Hi Bob! Nice to hear from you
[Peer] Sent message to bob: Hi Bob! Nice to hear from you

> messages
Message history:
  [direct from bob] Hello Alice! This is Bob
```

#### **BÆ°á»›c 4: Test Broadcast**

**Terminal 3 - Charlie:**
```bash
python peer_client.py --username charlie --peer-port 9103 --tracker-ip 127.0.0.1 --tracker-port 8001
```

**Trong Alice terminal:**
```
> connect bob 127.0.0.1 9102
> connect charlie 127.0.0.1 9103
> broadcast Hello everyone! This is Alice
[Peer] Broadcasted to 2 peers: Hello everyone! This is Alice
```

**Káº¿t quáº£:**
- Bob vÃ  Charlie Ä‘á»u nháº­n Ä‘Æ°á»£c broadcast message âœ…
